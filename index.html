<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Secure file transfer tool with direct peer-to-peer sharing. No server upload required.">
    <title>Secure File Transfer Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .container {
            max-width: 500px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #downloadBtn {
            background: green;
            color: white;
            display: none;
        }
        #confirmBtn {
            display: none;
            background: blue;
            color: white;
        }
        .ad-container {
            margin-top: 20px;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Secure File Transfer</h2>
        <p>Select your role:</p>
        <button onclick="setRole('sender')">Sender</button>
        <button onclick="setRole('receiver')">Receiver</button>
        
        <div id="senderBox" style="display: none;">
            <input type="text" id="subject" placeholder="Enter Subject Line">
            <input type="file" id="fileInput" accept=".zip,.rar" onchange="checkInputs()">
            <button id="generateCodeBtn" onclick="generateCode()" disabled>Generate Code</button>
            <p id="codeDisplay"></p>
        </div>

        <div id="receiverBox" style="display: none;">
            <input type="text" id="inputCode" placeholder="Enter One-Time Code">
            <button onclick="validateCode()">Validate Code</button>
            <p id="subjectDisplay"></p>
            <button id="confirmBtn" onclick="confirmTransfer()">Confirm</button>
            <button id="downloadBtn" onclick="downloadFile()">Download File</button>
        </div>
    </div>

    <div class="ad-container">
        <!-- Google AdSense Code Placeholder -->
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: "YOUR_ADSENSE_CLIENT_ID",
                enable_page_level_ads: true
            });
        </script>
    </div>

    <script>
        let role, oneTimeCode = null, file = null, expiration = null, subject = null;

        function setRole(selectedRole) {
            role = selectedRole;
            document.getElementById('senderBox').style.display = (role === 'sender') ? 'block' : 'none';
            document.getElementById('receiverBox').style.display = (role === 'receiver') ? 'block' : 'none';
        }

        function checkInputs() {
            const subjectValue = document.getElementById('subject').value;
            file = document.getElementById('fileInput').files[0];
            document.getElementById('generateCodeBtn').disabled = !(subjectValue && file);
        }

        function generateCode() {
            if (!file || !document.getElementById('subject').value) {
                alert('Please enter a subject and select a file before generating the code.');
                return;
            }
            oneTimeCode = Math.floor(100000 + Math.random() * 900000);
            expiration = Date.now() + 120000;
            subject = document.getElementById('subject').value;
            localStorage.setItem('oneTimeCode', oneTimeCode);
            localStorage.setItem('expiration', expiration);
            localStorage.setItem('subject', subject);
            document.getElementById('codeDisplay').innerHTML = `Share this code: <strong>${oneTimeCode}</strong> (Expires in 2 min)`;
        }

        function validateCode() {
            const enteredCode = document.getElementById('inputCode').value;
            const storedCode = localStorage.getItem('oneTimeCode');
            const storedExpiration = parseInt(localStorage.getItem('expiration'));
            const storedSubject = localStorage.getItem('subject');

            if (enteredCode == storedCode && Date.now() < storedExpiration) {
                document.getElementById('subjectDisplay').innerHTML = `Subject: ${storedSubject}`;
                document.getElementById('confirmBtn').style.display = 'block';
            } else {
                alert('Invalid or expired code. Please request a new one.');
            }
        }

        function confirmTransfer() {
            document.getElementById('downloadBtn').style.display = 'block';
        }

        function downloadFile() {
            if (!file) {
                alert('File is not available for download.');
                return;
            }
            const url = URL.createObjectURL(file);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
